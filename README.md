# Микросервис Регистрации и Авторизации Пользователей

Этот микросервис предоставляет функционал для регистрации и авторизации пользователей, построенный на фреймворке FastAPI.

## Функциональные возможности

- **Регистрация пользователей**: Пользователи могут зарегистрироваться, предоставив необходимые данные.
- **Авторизация пользователей**: Пользователи могут войти в систему, используя зарегистрированные учетные данные.
- **Восстановление пароля**: Пользователи могут восстановить (обновить) пароль от своей учетной записи, если это необходимо.
- **Подтверждение почтой**: Все действия — регистрация, авторизация, восстановление пароля — требуют подтверждения одноразовым 4-значным кодом, который отправляется на почту.
- **Контроль безопасности**: Каждое последующее действие не может быть выполнено, пока не выполнено предыдущее, с использованием уникальных ключей сессии.
- **JWT-аутентификация**: Для безопасной аутентификации используются JSON Web Tokens (JWT).
- **Шифрование паролей**: Пароли надежно шифруются с использованием PBKDF2.
- **Ролевая модель доступа**: Различные роли и разрешения для пользователей.

## Содержание

- [Микросервис Регистрации и Авторизации Пользователей](#микросервис-регистрации-и-авторизации-пользователей)
  - [Функциональные возможности](#функциональные-возможности)
  - [Содержание](#содержание)
    - [Краткое описание структуры](#краткое-описание-структуры)
  - [Начало работы](#начало-работы)
    - [Установка](#установка)
    - [Запуск сервиса](#запуск-сервиса)
  - [API Документация](#api-документация)
  - [Контакты](#контакты)

___

### Краткое описание структуры

**Каталоги:**
* **alembic**: Модуль для работы с миграциями баз данных.
* **api**: API проекта с маршрутами.
* **backend**: Логика проекта.
* **database**: Работа с базами данных через SQLAlchemy.
* **jwt_tools**: Модуль для работы с JWT токеном: создание токена, декодирование, декорирование маршрутов.
* **models**: Pydantic модели проекта для валидации данных.
* **redis_tools**: Подключение и работа с хранилищем Redis.
* **template_message**: Шаблоны сообщений для писем на почту.

**Файлы:**
* **alembic.ini**: Конфигурационный файл с настройками миграций на Alembic.
* **config.py**: Конфигурационный файл проекта для получения переменных из окружения.
* **docker-compose.yaml**: Конфигурация docker-compose для запуска нескольких приложений в разных контейнерах.
* **Dockerfile**: Конфигурация Docker для запуска контейнера с основным приложением.
* **main.py**: Исполнительный файл проекта.
* **nginx.config**: Конфигурационный файл с настройками сервера Nginx.
* **README.md**: Файл описания проекта.
* **requirements.txt**: Файл с описанием зависимостей, используемых в проекте.

___

## Начало работы

Эти инструкции помогут вам запустить копию проекта на локальном компьютере для целей разработки и тестирования.

### Установка

1. Клонируйте репозиторий:
    ```sh
    git clone https://github.com/TURRA7/REGISTRATION_AUTHORIZATION.git
    ```
2. Перейдите в директорию проекта:
    ```sh
    cd REGISTRATION_AUTHORIZATION
    ```
3. В файлах **docker-compose.yaml** и **nginx.conf** укажите свои данные, согласно комментариям. Для указания доменного имени, его следует зарегистрировать в панели управления вашего хоста и привязать IP к доменному имени.
4. Для отправки писем настройте SMTP в своей почте и получите пароль. Раздел для настройки SMTP обычно находится в разделе "сторонние/внешние сервисы -> SMTP".
5. Если вы хотите использовать **https** соединение, установите **certbot** для получения **SSL сертификата**. Если достаточно HTTP, удалите строки 30–36 из конфигурации. Для получения сертификата:
    1. Перейдите на сайт:
         ```
         https://certbot.eff.org/instructions
         ```
    2. Выберите свой сервер в **Software** и операционную систему в **System**.
    3. Следуйте инструкциям.
    4. После получения сертификата, найдите файлы **.crt** и **.key** с помощью команд:
        ```
        sudo find /etc -name "*.crt"
        sudo find /etc -name "*.key"
        ```
    5. Укажите их расположение в файле **nginx.conf** (строки 31 и 32) и в **docker-compose.yaml** (строки 71 и 72).

### Запуск сервиса

1. Для сборки контейнера выполните команду:
    ```sh
    docker-compose build
    ```
    или
    ```sh
    sudo docker-compose build
    ```
    **Ожидайте завершения сборки контейнера.**

2. Для запуска контейнера используйте команду:
    ```sh
    docker-compose up
    ```
    или
    ```sh
    sudo docker-compose up
    ```
   **После запуска контейнера, сервис будет доступен.**

3. Для остановки работы контейнера нажмите **Ctrl + C** в терминале.

4. Для разборки контейнера до образа выполните команду:
    ```sh
    docker-compose down
    ```
    или
    ```sh
    sudo docker-compose down
    ```
    **После этого вы можете внести изменения в проект и пересобрать его с помощью команды из первого пункта.**

Сервер будет доступен по адресу `http://localhost:8000`. Указав вместо "localhost" IP-адрес или доменное имя, сервер будет запущен на них.

## API Документация

Подробное описание API доступно по адресу `http://localhost:8000/docs`.

___

## Контакты

Моя почта: **turra777@mail.ru**

Мой телеграм: **https://t.me/chicano_712**
